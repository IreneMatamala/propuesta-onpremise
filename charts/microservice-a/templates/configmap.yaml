apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "microservice-a.fullname" . }}-config
  namespace: {{ .Values.namespace | default "default" }}
  labels:
    {{- include "microservice-a.labels" . | nindent 4 }}
data:
  # Configuración de la aplicación
  app_config.json: |
    {
      "app": {
        "name": "{{ .Chart.Name }}",
        "environment": "{{ .Values.environment }}",
        "debug": {{ .Values.debug | default false }}
      },
      "server": {
        "port": {{ .Values.service.port }},
        "workers": {{ .Values.server.workers | default 4 }},
        "timeout": {{ .Values.server.timeout | default 30 }}
      },
      "database": {
        "pool_size": {{ .Values.database.poolSize | default 10 }},
        "pool_timeout": {{ .Values.database.poolTimeout | default 30 }},
        "max_overflow": {{ .Values.database.maxOverflow | default 20 }}
      },
      "logging": {
        "level": "{{ .Values.logging.level | default "INFO" }}",
        "format": "{{ .Values.logging.format | default "json" }}",
        "output": "{{ .Values.logging.output | default "stdout" }}"
      },
      "features": {
        "cache_enabled": {{ .Values.features.cacheEnabled | default false }},
        "rate_limit_enabled": {{ .Values.features.rateLimitEnabled | default true }},
        "cors_enabled": {{ .Values.features.corsEnabled | default true }}
      }
    }
  
  # Configuración específica por entorno
  environment.conf: |
    ENVIRONMENT={{ .Values.environment }}
    APP_VERSION={{ .Chart.AppVersion | default .Chart.Version }}
    LOG_LEVEL={{ .Values.logging.level | default "INFO" }}
    MAX_CONNECTIONS={{ .Values.database.poolSize | default 10 }}
  
  # Configuración de nginx (si se usa)
  nginx.conf: |
    server {
      listen 8000;
      server_name localhost;
      
      location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
      }
      
      location /health {
        access_log off;
        return 200 "healthy\n";
      }
    }
